#!/usr/bin/env sh

UNAME=$(uname)

case $UNAME in
    *BSD)
        MAKE=gmake
        ;;
    *)
        MAKE=make
        ;;
esac

case $1 in
    vim)
        mkdir -p ~/.vim/colors
        cp init.vim ~/.vimrc
        cp newdefault.vim ~/.vim/colors/newdefault.vim
        vim +'PlugInstall --sync' +qa
        cd ~/.vim/plugged/clang_complete && \
            $MAKE && \
            $MAKE install
        ;;
    nvim|neovim)
        mkdir -p ~/.config/nvim/colors
        cp init.vim ~/.config/nvim
        cp newdefault.vim ~/.config/nvim/colors/newdefault.vim
        nvim +'PlugInstall --sync' +qa
        if [ ! -f ~/.config/nvim/plugged/clang_complete/.modified ]; then
            sed -i 's/vim/nvim/g' ~/.config/nvim/plugged/clang_complete
            touch ~/.config/nvim/plugged/clang_complete/.modified
        fi
        cd ~/.config/nvim/plugged/clang_complete && \
            $MAKE && \
            $MAKE install
        ;;
    all|both)
        $0 vim
        $0 neovim
        ;;
    *)
        echo "Invalid vim executable name"
        ;;
esac
